# Week6_과제 제출

## Summary

배달 데이터를 바탕으로 (위치, 메뉴, 평가지표 등) 배달 시간을 예측하는 문제를 해결하고자 한다. 이를 위해, 데이터를 표준화 및 전처리 하였으며, 특히 메뉴(Cuisines) 관련 해서는 대표적인 메뉴군들에 대해서 해당되는 품목이 있는지 라벨링을 실시하였다. 이를 바탕으로, 선형회귀 분석을 실시한 결과 평균값으로는 약 8분정도의 오차, 늦은 배달에 2배의 페널티를 부여한 기준으로는 9분 정도의 오차를 보였다.

또한, Delivery_Time이 7개 정도의 값으로 퍼져 있어 대표적인 분류 모델인 트리 모델 및 이를 보안한 랜덤포레스트와의 결과를 비교해 보았다. 추가로, 선형 모델 개선을 위해 PCA 및, 변수선택의 한 방법이 될 수 있는 Lasso 회귀를 통해 주성분을 추출하여 분석 및 비교하였다.

## 전처리

- 초기 결측치는 모두 제거하였다. 
- Location 또한 Cuisines의 전체 내용에서 각 지역 및 메뉴구분이 몇개가 있는지 센 후, 400개 이상이 되는 구분에 대해서 해당 구분을 다룰 경우 1, 아닐 경우 0으로 표현되는 특성을 생성하였다.
- 그 이외 AverageCost, MinimumOrder, Rating, Votes, Reviews에서는 Rating을 제외하고는 왼쪽으로 극히 치우진 형태의 데이터 분포를 가지고 있어 로그 변환을 시켰고, 전체에 대해서 정규화를 실시하였다.

## 사용 모델 및 기법

- 선형회귀모델
- 결정트리
- 랜덤포레스트
- PCA
- Lasso
- SGD

## Loss function

아쉽게도 scikit-learn에서 자체로 built-in된 형태로 함수를 사용할 수 없고, 미분을 해서 직접 구하려자니 절대값 함수 특성상 미분하기에는 어려운 점이 있어 어쩔 수 없이 MSE를 활용할 수 밖에 없었다. 결정 트리의 경우는 지니불순도를 기준으로 구분하였다.

## 평가지표

평가지표는 크게 3가지를 활용하였다.

- MAE
  $$
  MAE = \frac{1}{N} \sum_{i}{|y_{i}-\hat{y}_{i}|}
  $$
  

- Weight-MAE
  $$
  WMAE = \frac{1}{\sum w_{i}} \sum_{i}{w_{i}|y_{i}-\hat{y}_{i}|}
  $$
  여기서, 늦은 배달에 대해서는 weight 2, 이른 배달에 대해서는 weight 1을 주면 된다.

- UnderPrediction - Ratio : under-prediction 개수 / 테스트 데이터의 샘플 수

  

## 결과

|                   | MAE     | Weighted-MAE | UnderPrediction |
| ----------------- | ------- | ------------ | --------------- |
| Linear Regression | 8.20224 | 8.95643      | 0.38297         |
| Decision Tree     | 6.72131 | 21.03345     | 0.20537         |
| Random Forest     | 6.25683 | 20.89184     | 0.25774         |
| PCA(n = 4)        | 8.46316 | 9.32636      | 0.37067         |
| Lasso             | 8.2348  | 9.11225      | 0.36566         |
| SGD Regressor     | 8.20082 | 8.93909      | 0.3857          |

- SGD Regressor가 Weight-MAE에서 가장 우수한 성능을 보이고 있다.
- Tree의 경우는 UnderPrediction 지표 자체는 우수하나, Weight-MAE에서는 매우 나쁜 성능을 보이고 있다. 